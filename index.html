<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://miro.com/app/static/sdk.1.1.js"></script>
    <script type="text/javascript">
    async function getTimerCoords() {
        var vp = await miro.board.viewport.getViewport();
        var xx = vp.x + (vp.width / 4);
        var yy = vp.y + (vp.height / 2);
        return { x : xx, y : yy };
    }
    async function countDown(v) {
    var waitASec = () => new Promise(r => setTimeout(r, 1000));
    var tcoords = await getTimerCoords();
    var st = await miro.board.widgets.create({type:'sticker', text: ''+v, x : tcoords.x, y : tcoords.y})
        .then((v) => v[0]);
     //await miro.board.viewport.zoomToObject(st);
    for(var i = v - 1; i >= 0; i--) {
        await waitASec();
        await miro.board.widgets.update({id: st.id, text: ''+i});
    }
    await miro.board.widgets.deleteById(st.id);
    }; 
    miro.onReady(() => {
      miro.initialize({
        extensionPoints: {
          bottomBar: {
            title: 'Timer',
            svgIcon: '<circle id="svg_2" stroke-width="2" stroke="currentColor" fill-rule="evenodd" fill="none" r="8" cy="12" cx="12"/><line id="svg_3" x1="9.444444" y1="9.777778" x2="11.952381" y2="13.555556" stroke-width="2" stroke="currentColor" fill-rule="evenodd" fill="none"/><line id="svg_4" x1="11.31746" y1="12.68254" x2="17.047619" y2="10.587302" stroke-width="2" stroke="currentColor" fill-rule="evenodd" fill="none"/><line id="svg_5" x1="12" y1="3" x2="12" y2="0" stroke-width="2" stroke="currentColor" fill-rule="evenodd" fill="none"/><line id="svg_6" x1="6" y1="0" x2="18" y2="0" stroke-width="2" stroke="currentColor" fill-rule="evenodd" fill="none"/>',
            onClick: async () => {
              await countDown(45);
            },
            onRightClick: () => { alert ('Hi!'); }
          }
        }
      })
    })
    </script>
</head>
</html>
