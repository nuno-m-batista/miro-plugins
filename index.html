<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://miro.com/app/static/sdk.1.1.js"></script>
    <script type="text/javascript">
    async function getTimerCoords() {
        var vp = await miro.board.viewport.getViewport();
        var xx = vp.x + (vp.width / 4);
        var yy = vp.y + (vp.height / 2);
        return { x : xx, y : yy };
    }
    async function countDown(v) {
    var waitASec = () => new Promise(r => setTimeout(r, 1000));
    var tcoords = await getTimerCoords();
    var st = await miro.board.widgets.create({type:'sticker', text: ''+v, x : tcoords.x, y : tcoords.y})
        .then((v) => v[0]);
     //await miro.board.viewport.zoomToObject(st);
    for(var i = v - 1; i >= 0; i--) {
        await waitASec();
        await miro.board.widgets.update({id: st.id, text: ''+i});
    }
    await miro.board.widgets.deleteById(st.id);
    }; 
    miro.onReady(() => {
      miro.initialize({
        extensionPoints: {
          bottomBar: {
            title: 'Timer',
            svgIcon: '<circle cx="12" cy="12" r="8" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2" /><line fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2" y2="18" x2="11" y1="12" x1="5" /><line fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2" y2="9" x2="18" y1="13" x1="11" /><line fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2" y2="0" x2="12" y1="3" x1="12" /><line fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2"  y2="0" x2="18" y1="0" x1="6" />',
            onClick: async () => {
              await countDown(45);
            },
            onRightClick: () => { alert ('Hi!'); }
          }
        }
      })
    })
    </script>
</head>
</html>
